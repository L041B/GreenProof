<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GreenProof</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="static/index.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>
<body>
    <header class="sticky-top">
        <nav class="navbar navbar-expand-lg bg-light navbar-light">
            <div class="container-fluid px-4">
                <!-- Left section -->
                <div class="d-flex align-items-center">
                    <a href="/" class="nav-link p-0 me-2">
                        <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Home" height="40">
                    </a>
                    <a class="navbar-brand mb-0" href="/">
                      GreenProof
                    </a>
                </div>
        
                <!-- Center section -->
                <form class="d-flex justify-content-center flex-grow-1 mx-4" style="max-width: 500px;" action="/search_companies" method="GET">
                    <input class="form-control me-2" type="search" placeholder="Search companies..." name="query">
                    <button class="btn btn-outline-success" type="submit">Search</button>
                </form>
                

                <!-- Right section -->
                <div class="d-flex align-items-center">
                    {% if user_id %}
                        {% include 'includes/user_menu.html' %}
                    {% else %}
                        <a class="btn btn-outline-primary ms-2" href="/login">Login</a>
                        <a class="btn btn-primary ms-2" href="/register">Sign in</a>
                    {% endif %}
                </div>
            </div>
        </nav>
    </header>
    
    <section class="hero-section">
        <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">
          <div class="carousel-inner">
            <div class="carousel-item active" data-bs-interval="4000">
              <img src="static/images/home1.jpg" class="d-block w-100" alt="Fresh Produce">
              <div class="carousel-caption">
                <h1>Sustainable Food Supply Chain</h1>
                <p></p>
                {% if not is_admin %}
                <a class="btn btn-success btn-lg" href="/company_register">Register Your Company</a>
                {% endif %}
              </div>
            </div>
            <div class="carousel-item" data-bs-interval="4000">
              <img src="static/images/home3.jpg" class="d-block w-100" alt="Fresh Produce">
              <div class="carousel-caption">
                <h1>Sustainable Food Supply Chain</h1>
                <p></p>
                {% if not is_admin %}
                <a class="btn btn-success btn-lg" href="/company_register">Register Your Company</a>
                {% endif %}
              </div>
            </div>
            <div class="carousel-item" data-bs-interval="4000">
              <img src="static/images/home4.jpg" class="d-block w-100" alt="Fresh Produce">
              <div class="carousel-caption">
                <h1>Sustainable Food Supply Chain</h1>
                <p></p>
                {% if not is_admin %}
                <a class="btn btn-success btn-lg" href="/company_register">Register Your Company</a>
                {% endif %}
              </div>
            </div>
            <div class="carousel-item" data-bs-interval="4000">
                <img src="static/images/home5.jpg" class="d-block w-100" alt="Fresh Produce">
                <div class="carousel-caption">
                  <h1>Sustainable Food Supply Chain</h1>
                  <p></p>                  
                  {% if not is_admin %}
                  <a class="btn btn-success btn-lg" href="/company_register">Register Your Company</a>
                  {% endif %}
                  <p></p>
                  <a class="btn btn-success btn-lg" href="/search_product">View Products</a>
                </div>
              </div>
          </div>
      
          <!-- Opzionali controlli per navigazione manuale -->
          <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
      </section>

<section id="about" class="py-5">
<div class="container">
<div class="row align-items-center">
<div class="col-md-6">
    <h2>About Us</h2>
    <p class="lead">
      Our Sustainable Food Supply Chain platform is a blockchain-based system that tracks CO₂ emissions of companies within the food supply chain. We classify their environmental behavior and promote transparency for a sustainable future.
    </p>
    <p>
      By providing verified data on each company's CO₂ footprint, GreenChain empowers consumers and stakeholders to make informed decisions and foster a healthier environment.
    </p>
  </div>
<div class="col-md-6">
<img src="static/images/home2.jpg" class="img-fluid rounded" alt="Farmers Working">
</div>
</div>
</div>
</section>

<section id="how-it-works" class="py-5 bg-light">
    <div class="container">
      <h2 class="text-center mb-5">How It Works</h2>
      <div class="row g-4">
        <div class="col-md-4 text-center">
          <div class="card h-100 border-0 bg-transparent">
            <i class="bi bi-arrow-repeat display-4 text-success"></i>
            <div class="card-body">
              <h5>Exchange Green Tokens</h5>
              <p>Companies trade green tokens as a way to offset emissions and invest in green initiatives.</p>
            </div>
          </div>
        </div>
        <div class="col-md-4 text-center">
          <div class="card h-100 border-0 bg-transparent">
            <i class="bi bi-bar-chart display-4 text-success"></i>
            <div class="card-body">
              <h5>Benchmark Impact</h5>
              <p>Users can browse and compare companies based on their CO₂ token balance to gauge environmental performance.</p>
            </div>
          </div>
        </div>
        <div class="col-md-4 text-center">
          <div class="card h-100 border-0 bg-transparent">
            <i class="bi bi-globe display-4 text-success"></i>
            <div class="card-body">
              <h5>Foster Sustainability</h5>
              <p>Our platform promotes transparency and accountability, encouraging greener practices in the food supply chain.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="products" class="py-5">
    <div class="container">
      <h2 class="text-center mb-5">Greener Companies</h2>
      <div class="row g-4">
        {% for company in top_companies %}
        <div class="col-md-4">
          <div class="card h-100">
            <img src="{{ company.company_image or 'https://images.unsplash.com/photo-1554469384-e58fac16e23a' }}" class="card-img-top" alt="{{ company.company_name }}">
            <div class="card-body">
              <h5 class="card-title">{{ company.company_name }}</h5>
              <p class="text-success fw-bold">{{ company.token }} Green Tokens</p>
              <a href="/information_company/{{ company.company_id }}" class="btn btn-success w-100">View Details</a>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </section>

  <section id="contact" class="py-5 bg-light">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-6 text-center">
          <h2>Contact Us</h2>
          <form id="contactForm" method="POST" action="/contact">
            <div class="mb-3">
              <input type="text" id="name" name="name" class="form-control" placeholder="Your Name" required minlength="2" maxlength="50">
              <div class="invalid-feedback" id="nameError"></div>
            </div>
            <div class="mb-3">
              <input type="email" id="email" name="email" class="form-control" placeholder="Your Email" required>
              <div class="invalid-feedback" id="emailError"></div>
            </div>
            <div class="mb-3">
                <textarea id="message" name="message" rows="5" class="form-control" placeholder="Your Message" required maxlength="500"></textarea>
                <div class="text-end"><small id="messageCount">0/500</small></div>
                <div class="invalid-feedback" id="messageError"></div>
              </div>
            <button type="submit" class="btn btn-success">Send Message</button>
          </form>
        </div>
      </div>
    </div>
  </section>
  <!-- Inserisci questo script subito prima della chiusura del tag </body> -->
<script>
    document.getElementById('message').addEventListener('input', function() {
      const length = this.value.length;
      document.getElementById('messageCount').textContent = `${length}/500`;
    });
  </script>

  <!-- Assicurati che il markup del Toast sia presente -->

<div class="toast-container position-fixed top-0 end-0 p-3">
    <div id="contactToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body">
          <!-- Il messaggio dinamico verrà inserito qui -->
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  </div>
  
  <script>
    function showToast(message, type) {
        const toastEl = document.getElementById('contactToast');
        const toastBody = toastEl.querySelector('.toast-body');
        toastBody.textContent = message;
        
        // Modifica il colore del toast in base al tipo (success o error)
        if (type === 'error') {
            toastEl.classList.remove('text-bg-success');
            toastEl.classList.add('text-bg-danger');
        } else {
            toastEl.classList.remove('text-bg-danger');
            toastEl.classList.add('text-bg-success');
        }
        
        // Crea e mostra il toast utilizzando l'API di Bootstrap
        const toast = new bootstrap.Toast(toastEl);
        toast.show();
    }
    
    document.getElementById('contactForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const form = event.target;
      
        // Clear any previous error messages
        form.querySelectorAll('.is-invalid').forEach(el => el.classList.remove('is-invalid'));
        form.querySelectorAll('.invalid-feedback').forEach(el => el.textContent = '');
      
        let valid = true;
        
        // Validate name
        const nameInput = document.getElementById('name');
        const nameError = document.getElementById('nameError');
        const nameValue = nameInput.value.trim();
        if(nameValue.length < 2 || nameValue.length > 50) {
            nameError.textContent = "Name must be between 2 and 50 characters.";
            nameInput.classList.add("is-invalid");
            valid = false;
        }
        
        // Validate email
        const emailInput = document.getElementById('email');
        const emailError = document.getElementById('emailError');
        const emailValue = emailInput.value.trim();
        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if(!emailPattern.test(emailValue)) {
            emailError.textContent = "Please enter a valid email address.";
            emailInput.classList.add("is-invalid");
            valid = false;
        }
        
        // Validate message
        const messageInput = document.getElementById('message');
        const messageError = document.getElementById('messageError');
        const messageValue = messageInput.value.trim();
        if(messageValue.length > 500) {
            messageError.textContent = "Message must not exceed 500 characters.";
            messageInput.classList.add("is-invalid");
            valid = false;
        }
        
        if (!valid) return;
        
        const formData = new FormData(form);
        
        fetch('/contact', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json().then(data => ({status: response.status, body: data})))
        .then(res => {
            // Se è rate limited (status 429) oppure se c'è un errore specifico, mostra il toast
            if (res.status === 429 || (res.body && res.body.error)) {
                const errorMessage = res.body.error || "An error occurred. Please try again later.";
                showToast(errorMessage, 'error');
                return;
            }
            
            // Se il messaggio è stato inviato correttamente, mostra il toast di successo
            if (res.status === 200 && res.body.success) {
                showToast("Il tuo messaggio è stato inviato correttamente.", 'success');
                // Resetta il form e il conteggio dei caratteri
                form.reset();
                document.getElementById('messageCount').textContent = "0/500";
            }
            
        })
        .catch(error => {
            console.error('Error:', error);
            showToast("An error occurred. Please try again later.", 'error');
        });
    });
  </script>

<footer class="bg-dark text-light py-4">
<div class="container">
<div class="row">
<div class="col-md-4">
<h5>GreenProof</h5>
<p>Empowering a greener future from farm to table</p>
</div>
<div class="col-md-4">
<h5>Quick Links</h5>
<ul class="list-unstyled">
<li><a href="#about" class="text-light">About Us</a></li>
<li><a href="#products" class="text-light">Greener Companies</a></li>
<li><a href="#contact" class="text-light">Contact</a></li>
</ul>
</div>
<div class="col-md-4">
<h5>Follow Us</h5>
<div class="social-icons">
<i class="bi bi-facebook me-2"></i>
<i class="bi bi-twitter-x me-2"></i>
<i class="bi bi-instagram"></i>
</div>
</div>
</div>
</div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>